# 1 引言
## 机器视觉的研究目标
1. ​核心目标
    - 通过图像感知三维信息（度量信息）
    - 通过图像理解语义信息（对象分类、场景理解）
2. ​应用场景示例
    - 医疗影像分析、自动驾驶、安防监控、工业检测、虚拟现实、火星探测等
## 机器视觉面临的挑战
1. ​**视点变化**
    - 同一物体在不同视角下的投影差异（如Michelangelo雕塑的多角度观察）
    - 解决方案：多视图几何（如立体视觉、运动恢复结构SFM）
2. ​**光照变化**
    - 光照强度、方向、颜色变化导致图像亮度失真（如Koenderink的光照实验）
    - 解决方案：光照不变特征提取（如梯度方向直方图HOG）
3. ​**比例变化**
    - 物体大小变化影响尺寸测量（如不同距离拍摄的同一物体）
    - 解决方案：尺度不变特征变换（SIFT）
4. ​**形变与遮挡**
    - 非刚性形变（如人体运动）、刚性遮挡（如物体相互遮挡）
    - 解决方案：鲁棒特征匹配（如RANSAC算法）
5. ​**背景干扰**
    - 复杂背景导致目标提取困难（如人群中的人脸检测）
    - 解决方案：背景建模（如高斯混合模型GMM）
6. ​**运动模糊与动态场景**
    - 快速运动导致的图像模糊（如赛车视频分析）
    - 解决方案：光流估计、运动补偿
7. ​**类内差异与局部歧义**
    - 同类物体外观差异大（如不同姿态的人脸）
    - 局部特征可能对应多种全局解释（如纹理歧义）
    - 解决方案：深度学习（如卷积神经网络CNN）、数据增强
## 线索挖掘方法
1. ​**深度线索**
    - ​**单目线索**：线性透视（近大远小）、空气透视（雾效）、纹理梯度（表面粗糙度变化）
    - ​**双目线索**：遮挡（前景遮挡背景）、视差（立体视觉）
2. ​**形状与结构线索**
    - 边缘、角点、斑块（Blob）检测
    - 霍夫变换（Hough Transform）提取直线、圆等几何形状
3. ​**运动线索**
    - 光流（Optical Flow）：像素运动速度场
    - 运动一致性约束（如Lucas-Kanade光流法）
4. ​**语义线索**
    - 分类线索：颜色、纹理、空间布局的相似性
    - 共同命运（Common Fate）：运动方向一致的物体属于同一类别
5. ​**先验知识与约束**
    - 物理规律（如刚性物体运动约束）
    - 统计学习（如训练数据集的统计特性）
## 和其他学科的关系
- ​**人工智能**：深度学习、强化学习
- ​**机器人学**：SLAM（即时定位与地图构建）
- ​**计算机图形学**：3D重建、渲染
- ​**心理学与神经科学**：视觉感知机制研究

# 2 相机成像原理
## 针孔投影模型(小孔成像模型)
相机的成像模型同小孔成像,故一般直接使用小孔成像模型来理解相机成像.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416160747.png]]
### 透视投影模型
#### 小孔成像坐标转换
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416162103.png]]
右侧是实际物体,左侧是成像屏.
其中$f'$是小孔到成像面的距离,在相机中则是凸透镜的焦距.

根据相似三角形可由实际物体的三维坐标得到投影到成像平面上的三维坐标:
$$(x,y,z)\to(f^{\prime}\frac{x}{z},f^{\prime}\frac{y}{z},f^{\prime})$$
又由于成像平面只需要xy坐标,即得到:
$$(f^{\prime}\frac{x}{z},f^{\prime}\frac{y}{z})$$
#### 齐次坐标
为了顺利表示平移过程,使之是线性变换,也就是说可以用矩阵运算表示(原因参见参考资料1),对于坐标点我们额外添加一个坐标,便是齐次坐标:
$$\begin{aligned}(x,y)&\Rightarrow\begin{bmatrix}x\\y\\1\end{bmatrix}&(x,y,z)\Rightarrow\begin{bmatrix}x\\y\\z\\1\end{bmatrix}\\&\text{齐次图像坐标}&\text{齐次场景坐标}\end{aligned}$$
齐次坐标转化为普通的图像/场景坐标的方法:
$$\begin{bmatrix}x\\y\\w\end{bmatrix}\Rightarrow(x/w,y/w)\quad\begin{bmatrix}x\\y\\z\\w\end{bmatrix}\Rightarrow(x/w,y/w,z/w)$$
所以,通过齐次坐标和矩阵运算实现投影操作的方法如下:
$$\begin{bmatrix}1&0&0&0\\0&1&0&0\\0&0&1/f’&0\end{bmatrix}\begin{bmatrix}x\\y\\z\\1\end{bmatrix}=\begin{bmatrix}x\\y\\z/f’\end{bmatrix}\Rightarrow(f’\frac{x}{z},f’\frac{y}{z})$$
#### 特殊投影形式:正射投影
假如投影中心距离成像平面无穷远($f'\to \infty$),那么就是正射投影.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416164812.png]]
那么由$f'\to \infty$可知,其投影矩阵为:
$$\begin{bmatrix}1&0&0&0\\0&1&0&0\\0&0&0&1\end{bmatrix}\begin{bmatrix}x\\y\\z\\1\end{bmatrix}=\begin{bmatrix}x\\y\\1\end{bmatrix}\Rightarrow(x,y)$$

参考资料:
[【相机模型都没弄懂，怎么搞机器人视觉算法？】 ](https://www.bilibili.com/video/BV12u411G71A/?share_source=copy_web&vd_source=34dd435d3d651e8a3a60eacd5873aed9)
## 相机与镜头
### 透镜的作用
透镜可以将光线汇聚到一个焦点上，从而在成像平面上形成清晰的图像,代替了小孔成像模型中小孔的位置.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416165313.png]]
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416165321.png]]
下图中f是凸透镜焦距.焦距是透镜中心到焦点的距离。焦距越短，视场越大；焦距越长，视场越小.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416165433.png]]
平行光线通过透镜后会汇聚在焦距处的焦点上.从相似三角形关系可以得到两个式子:$$\begin{aligned}\mathbf{y^{\prime}/y}&=\mathbf{D^{\prime}/D}\\\mathbf{y^{\prime}/y}&=(\mathbf{D^{\prime}-f})/\mathbf{D}\end{aligned}$$
转化一下可以得到薄透镜方程(薄透镜公式):
$$\frac{1}{\mathrm{D^{\prime}}}+\frac{1}{\mathrm{D}}=\frac{1}{\mathrm{f}}$$
满足这个方程的点就是焦点.
### 光圈调节
在上面关于凸透镜作用的讨论中,如果一个物体的点投影后不在成像面上汇聚成点,那么就会形成一个光斑(散光圈):
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416165748.png]]
这个散光圈的大小和相机镜头开孔大小有关,也就是和光圈有关.

光圈是相机镜头中的一个开口，用于控制进入相机的光线量.

**光圈大小的影响**：
- 较大的光圈允许更多的光线进入，适合低光环境，但可能导致较浅的景深。
- 较小的光圈限制光线量，适合明亮环境，但可能导致较深的景深。
### 景深效果
上面讲到的散光圈,产生的就是景深效果.景深就是在焦外的物体成像,产生的模糊像.光圈越大,景深越大.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416170019.png]]
### 焦平面控制
上面关于相机成像的讨论都是在焦平面平行于图像平面和镜头平面的情况下讨论的,如下图:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416170221.png]]
如果倾斜镜头,就可以使三者不平行,产生特殊效果:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416170258.png]]
产生的效果被称为移轴摄影.
### 视野与焦距
视场(视野)是指相机能够捕捉到的场景范围，取决于焦距和传感器尺寸.

焦距越大,传感器尺寸越小,视野越窄;
焦距越小,传感器尺寸越大,视野越宽.

视野的定量计算:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416170549.png]]
上图中,$\varphi$就是用角度表示的视野,由图有公式:
$$\varphi=\tan^{-1}(\frac{d}{2f})$$
### 镜头缺陷
1. 色差
   不同波长的透镜具有不同的折射率：导致边缘颜色出现偏差
   ![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416170805.png]]
2. 球形像差
   球面透镜不能很好地聚焦光线,导致光线离光轴越远焦点越近
   ![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416170850.png]]
3. 渐晕
   渐晕是指图像边缘比中心区域暗淡的现象。这种现象通常是由于光线在通过透镜时，某些部分的光线被遮挡或衰减所导致的.
   ![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416170926.png]]
4. 径向畸变
   由透镜缺陷引起的图像畸变，常见的有枕形畸变和桶形畸变.
   ![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416171835.png]]
## 数码相机
### 传感器类型
数码相机利用传感器阵列取代屏幕.
数组中的每一个细胞都是光敏二极管，将光子转换为电子.

数码相机的传感器有两种最常见的材料,分别是电荷耦合器件(CCD)和互补金属氧化物半导体(CMOS).
#### CCD
通过芯片传输电荷，在每一个角落都能读到它。然后模拟-数字转换器（ADC）通过测量每个光点的电荷量并将测量值转换为二进制形式，将每个像素的值转换为数字值。
#### CMOS
在每个像素上使用几个晶体管，用更传统的电线来放大和移动电荷。CMOS信号是数字信号，因此不需要ADC。
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416172454.png]]
### 颜色感知
彩色摄像机需要放置红绿蓝三种颜色的传感器,有下面常见几种方法:
#### 拜尔滤镜阵列
下图是拜尔网络.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416172728.png]]
由于绿色传感器比红蓝传感器多一倍,所以产生的图像可能出现偏绿的情况.还有可能出现颜色波纹问题.
#### 棱镜分光
使用棱镜分光的色彩感知原理如下图.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416172908.png]]
每个像素都需要三个芯片采集各自颜色,所以这个方法更加昂贵.
#### Foveon X3传感器
利用了红色,蓝色和绿色的光穿透硅不同深度,再进行采集颜色.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416173006.png]]
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416173010.png]]

# 3 图像的基本概念
## 图像的数字化
### 模拟图像和数字图像
- 模拟图像：从连续的客观场景直接观察到的图像是空间连续和幅度连续的，用一个2-D数组f (x, y)来表示，f，x，y的值可以是任意实数。
- 数字图像：把连续的模拟图像在坐标空间XY和性质空间F都离散化了的图像，用f(x, y)代表数字图像，f，x，y都为整数
### 采样
采样是指将在空间上连续的图像转换成离散的采样点（即像素）集的操作.
采样是在x轴和y轴两个方向上进行。一般情况下，x轴方向与y轴方向的采样间隔相同。

采样时的注意点是：采样间隔的选取，以及采样保持方式的选取.

- 间隔太小会增加数据量。
- 间隔太大会导致频率混叠现象(高频率分量被误识别成低频分量)。

采样保持，一般不做特殊说明都是采用0阶保持的方式，即一个像素的值是其局部区域亮度（颜色）的均值.
### 分辨率
分辨率是指映射到图像平面上的单个像素的景物元素的尺寸.
常用单位为:像素/英寸和像素/厘米.
### 量化
量化是将各个像素所含的明暗信息离散化后，用数字来表示.
一般使用8bit及以上分辨率的量化;如果使用3bit以下的量化,容易出现伪轮廓现象.

量化可分为均匀量化和非均匀量化。均匀量化是简单地在灰度范围内等间隔量化。非均匀量化是对像素出现频度少的部分量化间隔取大，而对频度大的量化间隔取小。
## 数字图像的描述
数字图像的描述是指如何用一个数值方式来表示一个图像.
因为矩阵是二维的，所以可以用矩阵来描述数字图像.

有两种常用坐标系用来表示图像或矩阵,在本课程中都是用矩阵坐标系来表示.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416175708.png]]
## 图像类型
### 黑白图像
每个像素只能是黑或白，像素值为0或1.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416175840.png]]
### 灰度图像
每个像素由一个量化的灰度级描述，没有彩色信息.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416175902.png]]
### 彩色图像
每个像素由RGB三原色构成，分别用不同的灰度级描述，通常用三个矩阵表示.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416175929.png]]
### 灰度直方图
这个好像是重点.

灰度直方图是灰度级的函数，统计图像中各灰度级出现的像素个数.
横坐标表示灰度级，纵坐标表示图像中对应某灰度级所出现的像素个数.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416180117.png]]
特点:所有空间信息丢失，但可以直接得到每个灰度级的像素个数.

应用:
- 判断图像是否合理利用了灰度级范围。
- 图像分割阈值选取：通过二峰性直方图选择阈值进行二值化处理。取二峰间的谷点为阈值点，可以得到好的２值处理的效果.

# 4 图像灰度变换
## γ矫正
CCD的输出电流强度$I$和入射光强度$L$并不是正比例关系,而是下面的对数关系:
$$I=C\cdot L^{\gamma}$$
因此,在获得信号$I$之后,必须对其进行γ矫正,才能使其显示较为准确的光强度.上式的逆变换:
$$L=\overline{C}\cdot I^{1/\gamma}$$
γ矫正的关键是确定γ值.
### 确定γ值
由第一个公式可得:
$$\log I=r\cdot\log L+\overline{C}$$
通过$\log I$和$\log L$的线性关系,通过二者斜率计算γ值.
$$\gamma=\tan\theta$$
(实际γ值一般在0.4-0.8之间)
### 对输入信息进行γ矫正
在知道γ值之后,通过下式进行计算原始光强度:
$$L=(I/C)^{1/\gamma}=\overline{C}\cdot I^{1/\gamma}$$
## 对比度展宽
通过扩大关心区域的对比度,将部分灰度区域强调出来,突出目标区域的细节.
公式:
$$g(i,j)=\begin{cases}\alpha f(i,j)\\\beta(f(i,j)-a)+g_a\\\gamma(f(i,j)-b)+g_b&\end{cases}$$
灰度调整效果:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416211635.png]]

**灰级窗**:若把该操作极端化,非目标区域的东西直接不显示梯度,则是上式中$\alpha=\gamma=0$,效果如下:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416211902.png]]

**灰级窗切片**:只保留感兴趣的部分，其余部分置为0.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416212236.png]]
## 动态范围调整
动态范围是指图像中从暗到亮的变化范围.
当动态范围过大的时候,过亮,过暗的部分像素点会导致高光和阴影的细节丢失掩盖.

动态范围的压缩可以将所关心部分的灰度级的变化范围扩大.分为线性动态范围调整和非线性动态范围调整.
### 线性动态范围调整
如图.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416212715.png]]
公式:
$$h^*(i,j)=\begin{cases}0&h(i,j)\leq a\\\frac{255}{b-a}h(i,j)-\frac{255a}{(b-a)}&h(i,j)\in(a,b)\\255&h(i,j)\geq b&\end{cases}$$
### 非线性动态范围调整
没有固定模式,通常取对数的方法(效果如下)来提高暗部对比度,原因是人眼对信号的处理是一个近似对数算子的环节.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416213004.png]]
## 直方图均衡化
目标:扩展高频灰度级，缩减低频灰度级.
### 具体步骤
1. 给出原图像f的灰度直方图$h(i)$
2. 计算灰度分布概率
	1. 求出原图像f的总体像素个数
	   $N_{f}=m*n$
	2. 计算每个灰度级的像素个数在整个图像中占的百分比(即分布概率):
	   $h_{s}(i)=\frac{h(i)}{N_{f}}(i=0,1,\dots,255)$
3. 计算灰度级的累计分布(把当前分布概率和前面的全部累积起来):
   $h_p(i)=\sum_{k=0}^ih_s(k)$
4. 计算新灰度级
   $g(i,j)=255\cdot h_{p}(k)$
## 伪彩色技术
把人眼难以区别的灰度变化，施以不同的彩色来提高识别率，这便是伪彩色技术.
### 基于亮度的伪彩色
通过一个点的灰度值来对其进行三种彩色的赋值.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250416220729.png]]
### 基于区域的伪彩色
给不同区域赋予不同颜色.

# 5 图像几何变换
## 图像的位置变换
所谓图像的位置变换是指图像的大小和形状不发生变化，只是将图像进行旋转和平移.
### 图像的平移
公式:
$$\begin{cases}x^{\prime}=x+\Delta x\\y^{\prime}=y+\Delta y&\end{cases}$$
*注意:由于平移后位置改变,需要在操作平移之前提前扩大画布*
### 图像的镜像
公式:
$$\begin{cases}x^{\prime}=x\\y^{\prime}=-y&\end{cases}(\text{水平镜像})$$
$$\begin{cases}x^{\prime}=-x\\y^{\prime}=y&\end{cases}(\text{垂直镜像})$$
镜像完x或y坐标会变成负的,需要再平移一下.
### 图像的旋转
公式:
$$\begin{cases}x^{\prime}=x\cos\theta-y\sin\theta\\y^{\prime}=x\sin\theta+y\cos\theta&\end{cases}$$
*注意:同样需要前期处理:扩大画布,取整处理,平移处理*
#### 图像旋转的后处理
图像旋转中,由于像素值是不连续的,旋转后会出现很多空洞.可以采用插值填充的方法来解决.

最简单的方法是行插值(或列插值)方法.对于空洞像素,直接使用前一点像素值填补它.
其他插值方式:双线性插值(四近邻求平均);灰度插值(离空洞最近的像素灰度值作为其灰度值)
## 图像的形状变换
### 图像的缩小
分为按比例缩小和不按比例缩小.

图像缩小实际上就是对原有的多个数据进行挑选或处理,最简单,也是按比例缩小的方法就是等间隔选取数据.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417001423.png]]
#### 具体操作步骤
设原图像大小为M\*N,缩小为k1M\*k2N，（k1<1，k2<1）
1. 设旧图像是F(i,j)， i=1,2,…,M,  j=1,2,…,N.
   新图像是I(x,y),  x=1,2,…,k1M, y=1,2,…,k2N.
2. $I(x,y)=F(c_{1}\cdot i,c_{2}\cdot j)$
   其中$c_{1}=\frac{1}{k_{1}},c_{1}=\frac{2}{k_{2}}$
### 图像的放大
相比较于图像缩小,图像放大的要点是需要对多出的空位填入适当的值，是信息的估计.

最简单的方法,若放大倍数k为整数,则将原图像中的每个像素值，填在新图像中对应的k\*k大小的子块中.
#### 具体操作步骤
普遍的图像放大步骤:
设原图像大小为M\*N,放大为k1M\*k2N，（k1>1，k2>1）
1. 设旧图像是F(i,j)， i=1,2,…,M,  j=1,2,…,N.
   新图像是I(x,y),  x=1,2,…,k1M, y=1,2,…,k2N.
2. $I(x,y)=F(c_{1}\cdot i,c_{2}\cdot j)$
   其中$c_{1}=\frac{1}{k_{1}},c_{1}=\frac{2}{k_{2}}$
### 图像的错切
公式:
$$\begin{cases}x^{\prime}=x+d_xy\\y^{\prime}=y&\end{cases}(x\text{方向的错切})$$
$$\begin{cases}x^{\prime}=x\\y^{\prime}=y+d_yx&\end{cases}(y\text{方向的错切})$$
效果:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417002946.png]]
## 三维物体的投影
### 投影变换
和第二章的小孔成像投影模型类似,这里讲述的也是把一个三维的点,通过一个已知的视点(这次视点不在原点),投影到投影平面上(这部分讨论中投影平面一般在z=0).
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417005315.png]]
公式:
$$\begin{array}{rcl}X&=&\frac{hx}{h-z}\\\\Y&=&\frac{hy}{h-z}\end{array}$$
公式的原理感觉和前面小孔成像也是一样的.
### 透视变换
接续上文,这里的情景和上面类似,不过刚才视点和三维点在同一编,这次在成像面的两边.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417005530.png]]
公式:
$$\begin{aligned}X&=\frac{fx}{f+z}\\\\Y&=\frac{fy}{f+z}\end{aligned}$$
## 几何畸变的矫正
当镜头没有正对拍摄目标物时，即目标物不是垂直于成像面上时，就会发生几何畸变.可以通过下面的式子所定义的线性几何变换进行矫正:
$$\begin{cases}x^{\prime}=a_1x+b_1y+c_1\\y^{\prime}=a_2x+b_2y+c_2&\end{cases}$$
如果是二次失真(非线性),可以使用更复杂的形式:
$$\begin{aligned}
x^{\prime}=k_{1}x+k_{2}y+k_{3}xy+k_{4}\\y^{\prime}=k_{5}x+k_{6}y+k_{7}xy+k_{8}
\end{aligned}$$

# 6 图像噪声抑制
## 均值滤波器
所谓的均值滤波是指在图像上，对待处理的像素给定一个模板，该模板包括了其周围的邻近像素。将模板中的全体像素的均值来替代原来的像素值的方法.

如果采集的这些像素的权重不一样,那么就是加权平均滤波器.
几个常见的甲醛平均滤波器:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417020233.png]]
## 中值滤波器
对于一维模板，将模板中的像素值由小到大排列，待处理像素灰度取中间位置的像素灰度值,便是中值滤波器.

中值滤波对于椒盐噪声的过滤效果较好,因为中值滤波的原理是取合理的邻近像素值来替代噪声点，所以只适合于椒盐噪声的去除，不适合高斯噪声的去除。
## 边界保持平滑滤波器
边界保持平滑滤波器平滑在处理时先判别当前像素是否为边界点，若是则不处理，若否则进行平滑处理.通过这样的逻辑可以保留图像在边界的对比度,不至于模糊.

K近邻(KNN)平滑滤波器算法是一个具有边界保持功能的滤波器.
#### K近邻(KNN)平滑滤波器算法
1. 以待处理像素为中心，作一个m\*m的作用模板
2. 在模板中，选择K个与待处理像素的灰度差为最小的像素
3. 将这K个像素的灰度均值（中值）替换掉原来的像素值

# 7 图像锐化
图像锐化的目的是加强图像中景物的边缘和轮廓,也就是要使灰度反差增强.因为边缘和轮廓都位于灰度突变的地方。所以锐化算法的实现是基于微分作用.

一阶微分的计算公式:
$$f^{\prime}(x,y)=\frac{\partial f}{\partial x}+\frac{\partial f}{\partial y}$$
离散化之后的形式:
$$\Delta f(i,j)=[f(i+1,j)-f(i,j)]+[f(i,j+1)-f(i,j)]$$
## 一阶梯度算法
### 单方向锐化
#### 水平方向的锐化
公式:
$$H=\begin{bmatrix}1&2&1\\0&0&0\\-1&-2&-1\end{bmatrix}$$
#### 垂直方向的锐化
公式:
$$H=\begin{bmatrix}1&0&-1\\2&0&-2\\1&0&-1\end{bmatrix}$$
### 无方向锐化
#### 交叉微分算法(Roberts算法)
Roberts算法使用两个卷积核来计算水平和垂直方向的梯度.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417023205.png]]
两个卷积核:
第一个:
$$G_x=f(x+1,y)-f(x,y+1)$$
$$\begin{bmatrix}1&0\\0&-1\end{bmatrix}$$
第二个:
$$G_y=f(x,y+1)-f(x+1,y)$$
$$\begin{bmatrix}0&1\\-1&0\end{bmatrix}$$
两个卷积核的计算结果进行结合:
$$G=\sqrt{G_x^2+G_y^2}$$
#### Sobel锐化算法
Sobel也使用两个卷积核如下,但是其卷积核更大.
$$g(i,j)=\{d_x^2(i,j)+d_y^2(i,j)\}^2$$
$$d_x=\begin{bmatrix}-1&0&1\\-2&0&2\\-1&0&1\end{bmatrix}\quad d_y=\begin{bmatrix}-1&-2&-1\\0&0&0\\1&2&1\end{bmatrix}$$
#### Priwitt锐化算法
类似上面两个,卷积核细节不同.
$$g(i,j)=\{d_x^2(i,j)+d_y^2(i,j)\}^2$$
$$d_x=\begin{bmatrix}-1&0&1\\-1&0&1\\-1&0&1\end{bmatrix}\quad d_y=\begin{bmatrix}-1&-1&-1\\0&0&0\\1&1&1\end{bmatrix}$$
#### 三种算法对比
Sobel算法与Priwitt算法的思路相同，属于同一类型，因此处理效果基本相同.
Roberts算法的模板为2\*2，提取出的信息较弱.
## 二阶微分算法
为了更好捕捉图像的边缘,可以引入二阶导数来进行锐化.
### Laplascian算法
二阶微分算法使用的拉普拉斯算子:
$$\nabla^2f=\frac{\partial^2f}{\partial x^2}+\frac{\partial^2f}{\partial y^2}=4f(i,j)-f(i+1,j)-f(i-1,j)-f(i,j+1)-f(i,j-1)$$
可得写成模板系数形式的拉普拉斯算子:
$$H_1=\begin{bmatrix}0&-1&0\\-1&4&-1\\0&-1&0\end{bmatrix}$$

可以直接对上面的算子进行改变,获得拉普拉斯的变形算子:
$$H_2=\begin{bmatrix}-1&-1&-1\\-1&8&-1\\-1&-1&-1\end{bmatrix}\quad H_3=\begin{bmatrix}1&-2&1\\-2&4&-2\\1&-2&1\end{bmatrix}\quad H_4=\begin{bmatrix}0&-1&0\\-1&5&-1\\0&-1&0\end{bmatrix}$$
### Wallis算法
由于人眼的视觉特性中包含对数关系,因此锐化的时候加入对数处理的方法来改进.
$$\begin{aligned}&g(i,j)=\log[f(i,j)]-\frac{1}{4}s\\&s=[\log f(i-1,j)+\log f(i+1,j)+\log f(i,j-1)+\log f(i,j+1)\end{aligned}$$
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417025511.png]]

# 8 彩色图像
## 彩色图像基础
可视光区的波长在400nm ~ 700nm，当光谱采样限制到三个人类视觉系统敏感的红、绿、蓝光波段时，对这三个光谱带的光能量进行采样，就可以得到一幅彩色图像。
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417030426.png]]
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417030445.png]]
## 彩色颜色模型
颜色的描述是通过建立色彩模型来实现的，不同的色彩模型对应于不同的处理目的。
### CIE XYZ
CIE（国际照明委员会）提出的标准颜色模型.
基于人眼的三元色理论，假设人眼有三个独立的感光细胞，分别对红、绿、蓝光敏感.

三刺激值（X, Y, Z）表示颜色的物理属性.
适用于颜色匹配和标准化.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417031521.png]]
### CIE Lab
Lab颜色空间是在1976年制定的等色空间，以克服在x，y色度图上相等的距离并不相当于我们所觉察到的相等色差的问题.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417031531.png]]
### RGB
以700nm(红)、546.1nm (绿)、435.8nm (蓝)三个色光为三基色,又称为物理三基色.通过这三基色按不同比例混合而成,便是RGB色系.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417031541.png]]
### HSI色系
- H（色度）：表示颜色的基本色调，0°为红色，120°为绿色，240°为蓝色。
- S（饱和度）：表示颜色的纯度，从0（灰色）到1（纯色）。
- I（亮度）：表示颜色的亮度，与颜色无关。

HSI色系设计符合人眼对颜色的感知方式.
### HSI与RGB的相互转换
#### RGB转HSI
$$\begin{aligned}&I=\frac{1}{\sqrt{3}}\left(R+G+B\right)\\&S=1-\frac{3\min(R,G,B)}{R+G+B}\\
&H=\begin{cases}\theta&G\geq B\\2\pi\theta&G\leq B&\end{cases}\quad\theta=\cos^{-1}\left[\frac{\frac{1}{2}[(R-G)+(R-B)]}{\sqrt{(R-G)^2+(R-B)(G-B)}}\right]\end{aligned}$$
#### HSI转RGB
1. 当0°≤H≤120°时$$\begin{aligned}&R=\frac{I}{\sqrt{3}}[1+\frac{S\cos(H)}{\cos(60^\circ-H)}]\\&B=\frac{I}{\sqrt{3}}(1-S)\\&G=\sqrt{3}I-R-B\end{aligned}$$
2. 当120°≤H≤240°时$$\begin{aligned}&G=\frac{I}{\sqrt{3}}[1+\frac{S\operatorname{cos}(H-120^{\circ})}{\operatorname{cos}(180^{\circ}-H)}]\\&R=\frac{I}{\sqrt{3}}(1-S)\\&B=\sqrt{3}I-R-G\end{aligned}$$
3. 当240°≤H＜300°时$$\begin{aligned}&B=\frac{I}{\sqrt{3}}[1+\frac{S\cos(H-240^\circ)}{\cos(300^\circ-H)}]\\&G=\frac{I}{\sqrt{3}}(1-S)\\&R=\sqrt{3}I-G-B\end{aligned}$$
*300°~360°之间为非可见光谱色，没有定义*
### YUV电视信号表色系
Y为亮度,U和V为色差信号.
设计目的是为了与黑白电视兼容.
### YUV与RGB的相互转换
#### RGB转YUV
$$\begin{aligned}&Y=0.299R+0.587G+0.114B\\&U=B-Y\\&V=R-Y\end{aligned}$$
#### YUV转RGB
$$\begin{aligned}&R=Y+V\\&G=Y-0.192U-0.509V\\&B=Y+U\end{aligned}$$
### YCbCr表色系
Y代表亮度,Cb,Cr为色差.

与YUV表色系统不同的是它充分考虑了色彩组成时RGB三色的重要因素。
YUV考虑的是色系转换的简单；YCbCr考虑的是压缩时可以充分取出冗余量。
### YCbCr与RGB的相互转换
#### RGB转YCbCr
$$\begin{aligned}&Y=0.299R+0.587G+0.114B\\&C_b=2(1-0.114)(B-Y)\\&Cr=2(1-0.299)(R-Y)\end{aligned}$$
#### YCbCr转RGB
$$\begin{aligned}&k_r=\frac{1}{2(1-0.299)}\quad k_b=\frac{1}{2(1-0.114)}\\&R=Y+k_r\cdot C_r\\&B=Y+k_b\cdot C_b\\&G=Y-0.299/0.587*k_{r}C_{r}-0.114/0.587*k_{b}C_{b}\end{aligned}$$
## 彩色图像处理
对于彩色图像,处理的方法是，将同样的操作在R,G, B三个分量上分别进行.
### 彩色补偿
由于常用的彩色图像设备具有较宽而且相互覆盖的光谱敏感区，加上待拍摄图像的染色是变化的，所以很难在三个分量图中将物体分离出来。这种现象称为颜色扩散.
#### 彩色补偿算法
1. 在画面上找到主观视觉看是纯红、绿、蓝的三个点。如果画面上没有，则做靶图（包括纯红、绿、蓝）进行拍摄.
2. 计算R* G* B\*的值
   由于亮度不变,采取下面操作$$\left.\left\{\begin{array}{c}R^*=0.30\cdot R_1+0.59\cdot G_1+0.11\cdot B_1\\G^*=0.30\cdot R_2+0.59\cdot G_2+0.11\cdot B_2\\B^*=0.30\cdot R_3+0.59\cdot G_3+0.11\cdot B_3\end{array}\right.\right.$$
3. 构造变换矩阵
   构建两个矩阵:$$A_1=\begin{bmatrix}R_1&R_2&R_3\\G_1&G_2&G_3\\B_1&B_2&B_3\end{bmatrix}\quad A_2=\begin{bmatrix}R^*&0&0\\0&G^*&0\\0&0&B^*\end{bmatrix}$$
4. 进行彩色补偿
   设新旧图像像素值分别为:$$S\left(i,j\right)=\begin{bmatrix}R_s\left(i,j\right)\\G_s\left(i,j\right)\\B_s\left(i,j\right)\end{bmatrix}\quad F\left(i,j\right)=\begin{bmatrix}R_F\left(i,j\right)\\G_F\left(i,j\right)\\B_F\left(i,j\right)\end{bmatrix}$$
   则$$\begin{aligned}S\left(i,j\right)&=C^{-1}*F\left(i,j\right)\\\\\text{其中:}&C=A_1*A_2^{-1}\end{aligned}$$
彩色补偿的作用:通过不同的颜色通道提取不同的目标物.
### 彩色平衡
一副彩色图像中,色通道的不同敏感度、增光因子、偏移量等原因可能导致三基色不平衡,导致显示时颜色不正常;因此需要将其矫正,称为彩色平衡.
#### 彩色平衡算法
1. 从画面中选出两点为灰色的点,设为:$$F_1=(R_1,G_1,B_1)\quad F_2=(R_2,G_2,B_2)$$
2. 设以G分量为基准,匹配R和B分量.$$Y_1=0.299\cdot R_1+0.587\cdot G_1+0.114\cdot B_1\quad Y_2=0.299\cdot R_2+0.587\cdot G_2+0.114\cdot B_2$$$$F_1^*=(Y_1,Y_1,Y_1)F_2^*=(Y_2,Y_2,Y_2)$$
3. 由$$\begin{aligned}&R_1^*=k1^*R_1+k2&&\text{求出:k1和k2}\\&R_2^*=k1^*R_2+k2\\&B_1^*=l1^*B_1+l2&&\text{求出:l1和l2}\\&B_2^*=l1^*B_2+l2\end{aligned}$$
4. $$\begin{aligned}&R(i,j)^*=k1^*R(i,j)+k2\\&B(i,j)^*=l1^*B(i,j)+l2\\&G(i,j)^*=G(i,j)\end{aligned}$$可得彩色平衡后的图像.

# 9 机器视觉的多视几何
## PDF补充:机器视觉的目标,任务及马尔视觉理论
### 机器视觉的概述
**定义**:计算机视觉是研究用计算机来模拟人和生物的视觉系统功能的技术学科.

**目标**:让计算机能够感知周围视觉世界,了解它的空间组成和变化规律.
过程:传感,抽象,判断,识别,理解
### 马尔视觉理论
#### 马尔视觉系统研究的三个层次
- 计算理论层次(为什么做)
  定义机器视觉的计算目的与计算策略;明确视觉系统的输入输出需求
- 表达与算法层次(怎么做)
  关注如何实现计算理论层定义的目标;这一层次的任务是设计数据结构和算法，以实现计算理论规定的目标.
- 硬件实现层次(用什么做)
  关注如何将算法部署到实际的硬件设备上;这一层次的任务是将表达与算法层的算法转化为可执行的代码，并在物理设备上运行.
#### 马尔视觉系统信息处理的三个阶段
- 图像低层处理
  低层处理阶段的主要目标是处理和分析原始图像数据，提取基本的视觉特征.
	- 图像获取
	- 图像预处理(包括滤波,增强,矫正)
- 中层处理;空间表达与建模
  中层处理阶段的目标是从低层特征中恢复场景的几何结构，构建场景的三维表示
  抽取图像特征,恢复其2.5维结构(深度等信息),进行建模与表达
- 高层分析
  识别和理解场景的语义信息，实现智能分析和决策;这一阶段关注图像的高级语义内容
  识别,分析,理解,描述
#### 马尔视觉理论特点
没有考虑视觉中的选择性与整体性;
不确定和多义性;
计算量大.
## 单视几何
### 透视投影模型
和[[数字图像处理与机器视觉-副本/2 相机成像原理#透视投影模型]]讲的一样,这里也是使用基于齐次坐标的中心投影模型.不过这里使用的矩阵复杂一点.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417112741.png]]
公式:
设三维点 $X=(X,Y,Z)^T$ 投影到图像平面坐标 $m=(u,v)^T$,则有
$$s\begin{bmatrix}u\\v\\1\end{bmatrix}=K\begin{bmatrix}R&\mathbf{t}\end{bmatrix}\begin{bmatrix}X\\Y\\Z\\1\end{bmatrix}$$
其中
$s$为比例因子,
$K$为相机内参矩阵,描述了相机内部的物理特性,包括焦距和主点位置,如下:$$K=\begin{bmatrix}f_x&s&u_0\\0&f_y&v_0\\0&0&1\end{bmatrix}$$
$\begin{bmatrix}R&\mathbf{t}\end{bmatrix}$为外参矩阵.外参矩阵由旋转矩阵 R 和平移向量 t 组成，表示相机在世界坐标系中的位置和姿态.其中 $R$ 是一个 3×3 的正交矩阵，$t$ 是一个 3×1 的平移向量.

在实际做题中,内参矩阵外参矩阵并不需要具体单独求解,而是通过计算下面介绍的单应性矩阵来求解成像关系.
### 单视的平面测量(使用单应性矩阵H)
单应性矩阵 $H$(Homography) 是一个 3×3 的非奇异矩阵，用于描述一个平面在两个不同视角下的投影关系.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417153649.png]]
上图中Π和其上的三维点X是被拍摄的物体,左下和右下两个点是摄像机的投影中心.
对于单视的平面测量这个要求,我们要做的是像上图一样,从右下角那个点拍摄照片,使用H将拍摄到的X(也就是m')转换到m(因为可见左下投影过去的是基本垂直于Π的),然后因为垂直,直接通过平面几何就可以得出Π上面各种距离的测量.因此重点就是知道两个摄像头,或者说m和m'两个像点之间的转换关系.

根据投影模型的公式,对于两个摄像机可以知道:
$$s_1\begin{bmatrix}u\\v\\1\end{bmatrix}=K_1\begin{bmatrix}R_1&\mathbf{t}_1\end{bmatrix}\begin{bmatrix}X\\Y\\Z\\1\end{bmatrix}$$
$$s_2\begin{bmatrix}u^{\prime}\\v^{\prime}\\1\end{bmatrix}=K_2\begin{bmatrix}R_2&\mathbf{t}_2\end{bmatrix}\begin{bmatrix}X\\Y\\Z\\1\end{bmatrix}$$
通过共同的三维点,就可以讲上面两个公式的左边联系起来,通过略去比例因子,乘各种内参外参矩阵,可以得到**两个像点的关系**(具体怎么求的我不知道,应该也不会要求那么细致):
$$\begin{bmatrix}u^{\prime}\\v^{\prime}\\1\end{bmatrix}=H\begin{bmatrix}u\\v\\1\end{bmatrix}$$
其中H就是单应性矩阵:
$$H=K_2\left(\begin{bmatrix}R_2&\mathbf{t}_2\end{bmatrix}\begin{bmatrix}I-\frac{1}{d}\mathbf{n}\mathbf{n}^T\end{bmatrix}\begin{bmatrix}R_1^T&-R_1^T\mathbf{t}_1\end{bmatrix}\right)K_1^{-1}$$
上面是更普适的情况,如果说假设两个摄像机内参K一致(或者理解成就是同一个相机拍摄两张照片),然后外参矩阵用一个相对位姿矩阵代替(直接代表两个相机之间的位姿关系),那么有H的简化版本:
$$H=K\left(\begin{bmatrix}R&\mathbf{t}\end{bmatrix}\begin{bmatrix}I-\frac{1}{d}\mathbf{n}\mathbf{n}^T\end{bmatrix}\right)K^{-1}$$
这是从原理出发得到H的方法.实际要做单目测量,我们不是直接求得外参内参矩阵,而是从拍摄照片中选取世界坐标系(这个坐标系的z=0平面在被测物体同一平面),标出四个点得到已知数据来求解H,此处略.

总之知道H之后要做的就是利用上面那个两个像点之间关系的式子,或者将其写成:
$$s\mathbf{m}^{\prime}=H\mathbf{m}$$
其中$s$是比例因子.
## 两视几何
两视几何是研究如何通过两个不同视角的图像恢复场景的三维结构.其核心是**对极几何（Epipolar Geometry）​**，描述两个相机之间的几何关系，以及图像点之间的对应约束.

核心目标：
- 利用两幅图像中的匹配点，恢复相机的相对位姿（旋转 R 和平移 t）。
- 通过三角测量（Triangulation）恢复三维点坐标。
### 对极几何
对极几何是研究两幅图像之间存在的几何。它和场景结构无关，只依赖于摄像机的内外参数.
#### 基本概念
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417162412.png]]
- 基线:连接两个摄像机光心(O和O')之间的直线
- 对极点:基线与像平面的交点
- 对极平面:过基线的平面
- 对极线:对极平面与图像平面的交线
- 基本矩阵$F$:对应点对之间的约束$m'^{T}Fm=0$
#### 公式推导
同样由投影模型的公式,对于两个摄像机拍摄同一个点M,有
$$
\begin{align}
x_{i}m_{i}=K[R_{0},t_{0}]M_{i} \\
x_{i}'m_{i}'=K'[R',t']M_{i}
\end{align}
$$
为了方便,取世界坐标系在第一个摄像机坐标系上,则
$$
\begin{align}
x_{i}m_{i}=K[I,0]M_{i}=PM_{i} \\
x_{i}'m_{i}'=K'[R,t]M_{i}=P'M_{i}
\end{align}
$$

和单视几何部分一样的思路,通过一样的$M_{i}$,可以得到两个m之间的关系:
$$m^{\prime T}(K'^{-T}[t]_\times RK^{-1})m=0$$
$$\text{其中 }[t]_\times\text{ 是平移向量 }t\text{ 的反对称矩阵:}[t]_\times=\begin{bmatrix}0&-t_z&t_y\\t_z&0&-t_x\\-t_y&t_x&0\end{bmatrix}$$
这里中间括号内的部分写成一整个矩阵,就是**基本矩阵**,表达了表达了两个像点m之间的关系:
$$\mathbf{F}=\mathbf{K}^{\prime-T}[\mathbf{t}]_\times\mathbf{R}\mathbf{K}^{-1}$$
基本矩阵是一个秩为2的3\*3矩阵,自由度为7.

与此同时,得到其他概念的数学公式:
**光心**:
$$
\begin{align}
O=[0\,0\,0\,1]^{T} \\
O'=[-R^{T}t,1]^{T}
\end{align}
$$
**对极点**:
$$
\begin{align}
e=PO'=KR^{T}t \\
e'=P'O=K't
\end{align}
$$
**对极线**:
$$
\begin{align}
l=e\times m \\
l'=e'\times m'
\end{align}
$$
**本质矩阵**:
由于基本矩阵包含相机内参,不太方便,所以取中间那部分作为本质矩阵:
$$\mathbf{E}=[\mathbf{t}]_\times\mathbf{R}$$
本质矩阵是一个秩为2 的3\*3矩阵,自由度为5.

不同元素之间的关系式:
$$\mathbf{l}=\mathbf{F}^T\mathbf{m}^{\prime}\quad\mathbf{l}^{\prime}=\mathbf{F}\mathbf{m}\quad\mathbf{F}\mathbf{e}=0\quad\mathbf{e}^T\mathbf{F}=0$$

F的具体算法略,因为看不懂.
### 重建
看不太懂.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417175206.png]]
### 景物平面与单应矩阵
单应矩阵的定义这里不再赘述.

**景物平面**是指三维空间中的一个平面，通常假设为 Z=0 的平面.

$$\begin{aligned}\text{若两视点投影矩阵为}\\\mathbf{P}&=\mathbf{K}\begin{bmatrix}\mathbf{I}&\mathbf{0}\end{bmatrix}\quad\mathbf{P}^{\prime}=\mathbf{K}^{\prime}\begin{bmatrix}\mathbf{R}&\mathbf{t}\end{bmatrix}\end{aligned}$$
$$\text{则空间平面}\quad\pi=\begin{pmatrix}\mathbf{n}^T&d\end{pmatrix}^T\quad\text{的单应矩阵H可表示为}$$
$$\mathbf{H}=\mathbf{K}^{\prime}(\mathbf{R}-\mathbf{tn}^T/\mathbf{d})\mathbf{K}^{-1}$$
#### 由F确定H
已知三个空间中的点$M_{1}M_{2}M_{3}$,它们都有各自投影到两个摄像机上的点,那么这三个景物点确定了一个空间平面.
$$\mathbf{Fe}=0\quad\mathbf{e^{\prime}}^\tau\mathbf{F}=0\longrightarrow\mathbf{e},\mathbf{e^{\prime}}$$
$$\begin{aligned}s_i\mathbf{m}_i^{^{\prime}}&=\mathbf{Hm}_i\quad s\mathbf{e}^{^{\prime}}=\mathbf{He}\longrightarrow\mathbf{H}\\i&=1,2,3\end{aligned}$$
#### 由H确定F
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417181807.png]]
## 三视几何
在两视几何中使用基本矩阵$F$描述两个摄像机之间的约束;
在三视几何中则使用三焦张量$T$描述(Trifocal Tensor)三个摄像机之间的约束;
在四个摄像机或更多视角的情况下不存在独立的约束,可以利用$F$和$T$来生成.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417183538.png]]
### 三焦张量
三焦张量由 三个3x3矩阵${T_{1},T_{2},T_{3}}$组成.
对于一个空间直线,三个视角中对应的投影分别记为$l,l',l''$,则有约束公式:
$$\mathbf{l}^T=\mathbf{l}^T[\mathbf{T}_1,\mathbf{T}_2,\mathbf{T}_3]\mathbf{l}^"$$
### 基本矩阵
基本矩阵与三焦张量的关系:
$$\mathbf{F}_{21}=[\mathbf{e}^{^{\prime}}]_\times[\mathbf{T}_1,\mathbf{T}_2,\mathbf{T}_3]\mathbf{e}^{^{\prime\prime}}$$
$$\mathbf{F}_{31}=[e^{\prime\prime}]_x[\mathbf{T}_1^T,\mathbf{T}_2^T,\mathbf{T}_3^T]e^{\prime}$$
### 投影矩阵
$$\mathbf{P}=\begin{bmatrix}\mathbf{I}&\mathbf{0}\end{bmatrix}$$
$$\mathbf{P}^{\prime}=\begin{bmatrix}[\mathbf{T}_1,\mathbf{T}_2,\mathbf{T}_3]\mathbf{e}^{\prime\prime}&\mathbf{e}^{\prime}\end{bmatrix}$$
$$\mathbf{P}^{\prime\prime}=\begin{bmatrix}(\mathbf{e}^{\prime\prime}\mathbf{e}^{\prime\prime T}-\mathbf{I})[\mathbf{T}_1^T,\mathbf{T}_2^T,\mathbf{T}_3^T]\mathbf{e}^{\prime}&\mathbf{e}^{\prime\prime}\end{bmatrix}$$

# 10 摄像机标定
## 概述
计算机视觉最主要的研究方向:三维重建.
三维重建就是指从图像出发恢复出空间点三维坐标的过程.
三维重建的三个关键步骤
（1）图像对应点的确定
（2）**摄像机标定**(本章内容)
（3）两图像间摄像机运动参数的确定

#### 内参矩阵K
每个摄像机都有其内参矩阵$K$:
$$K=\begin{bmatrix}f_x&s&c_x\\0&f_y&c_y\\0&0&1\end{bmatrix}$$
其中:
- fx​,fy​：焦距（像素单位）
- cx​,cy​：主点坐标
- s：像素偏斜系数（通常为0）

摄像机标定分为**三类方法**:
- 传统摄像机标定方法
	- 特点：依赖已知景物结构（如标定块）
	- 优点：高精度，适用于任意模型
	- 缺点：流程复杂，需高精度标定物
- 主动视觉摄像机标定方法
	- 特点：利用摄像机运动信息（如已知运动轨迹）
	- 优点：线性求解，鲁棒性强
	- 缺点：依赖可控运动场景
- 摄像机自标定方法
	- 特点：仅依赖图像间对应关系
	- 优点：灵活性高，无需标定物
	- 缺点：非线性优化，鲁棒性较低
## 传统标定方法
传统标定方法有许多种.
哈哈我根本看不懂,记一下各种的特点吧.
### 直接线性变换(DLT变换)
建立线性模型，通过线性方程求解参数.

一样从透视投影公式开始推导:
$$s\begin{bmatrix}u\\v\\1\end{bmatrix}=P_{3\times4}\begin{bmatrix}X_w\\Y_w\\Z_w\\1\end{bmatrix}$$
其中P为3x4的透视投影矩阵.

![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417231016.png]]
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417231041.png]]
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417231048.png]]
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417231108.png]]
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250417231113.png]]
反正总的思路大概就是采集足够多的点对,构建$AL=0$的线性方程组,然后求解一个最小值.
### RAC方法
该方法利用径向畸变的几何一致性约束，分离内参与外参，简化求解过程.
特点:使用的大部分方程是线性方程,降低了参数求解的复杂性.

在该方法中,K取做:
$$K=\begin{pmatrix}fs,&0,&u_0\\0,&f,&v_0\\0,&0,&1\end{pmatrix}$$
#### 相机模型
此处只考虑径向畸变.
#### 径向一致约束
所有点的径向方向与主轴方向一致.
$$\frac{x-u_c}{y-v_c}=\frac{u-u_c}{v-v_c}$$
又通常取图像中心作为畸变中心和主点坐标,故
$$\frac{x-u_0}{y-v_0}=\frac{u-u_0}{v-v_0}$$
### 张正友的平面标定方法
通过拍摄平面标定板（如棋盘格）的多视角图像，结合平面投影模型求解内外参数.
张正友的平面标定方法是介于传统标定方法和自标定方法之间的一种方法。它既避免了传统方法设备要求高，操作繁琐等缺点，又较自标定方法精度高.
缺点是需要确定模板上点阵的物理坐标以及图像和模板之间的点的匹配.

主要思路:
1. 使用棋盘格标定板,使用角点作为特征点;取棋盘格板平面为世界坐标系Z=0平面.
2. 拍摄至少三张标定板图像.
3. 特征提取:检测角点的成像坐标(u,v)
4. 参数求解(DLT或其他方法)
### 孟胡的平面圆标定方法
利用圆环点（绝对二次曲线上的无穷远点）的射影几何性质，通过圆图像计算内参矩阵.
过程和张正友基本一致;所用的模板不同,孟胡方法基于曲线拟合,不需要任何匹配.
### 吴等的平行圆标定方法
利用平行圆的准仿射不变性，通过图像中平行圆的交点计算内参.

和其他基于圆的方法的对比:
- 从最小个数出发
- 计算圆环点图像简单
- 只需要从拟合的二次曲线出发,不需要任何匹配,不需要计算圆心
- 应用场合广泛
## 主动视觉标定方法
### 基于平面单应矩阵的正交运动方法
- ​**特点**：通过摄像机的正交运动（如平移和旋转）来获取标定信息。
- ​**原理**：利用平面单应矩阵的性质，通过两组正交运动来求解摄像机的内参和外参。
- ​**优点**：只需两组正交运动即可求解所有内参，简化了标定过程。
- ​**适用场景**：适用于需要精确控制摄像机运动的场合。
### 基于外极点的正交运动方法
- ​**特点**：通过外极几何关系来求解摄像机参数。
- ​**原理**：利用外极点（epipole）的几何特性，通过两组正交运动来求解内参和外参。
- ​**优点**：能够有效利用外极几何的约束，提高标定精度。
- ​**适用场景**：适用于需要高精度标定的场合。
### 马颂德的三正交运动法
- ​**特点**：通过三组正交运动来求解摄像机参数。
- ​**原理**：利用三组正交运动来获取足够的约束条件，从而求解内参和外参。
- ​**优点**：经典方法，适用于多种摄像机模型。
- ​**缺点**：需要三组正交运动，实现较为复杂。
## 自标定方法
自标定方法通过图像之间的对应关系来标定摄像机，不需要额外的标定物或已知运动信息.
 优点：灵活，方便。
 缺点：精度不太高，鲁棒性不足。
#### 基于Kruppa方程的自标定方法
通过绝对二次曲线建立关于摄像机内参的约束方程.
#### 基于绝对二次曲面的自标定方法
利用绝对二次曲面的射影几何特性，通过图像点之间的对应关系来求解内参.
#### 基于无穷远平面的自标定方法
通过无穷远平面的单应矩阵来求解摄像机内参.
#### 集中自标定方程的关系
基于绝对二次曲面的标定方程与基于无穷远平面的标定方程完全等价.
由绝对二次曲面的标定方程或无穷远平面的标定方程可以推出Kruppa 方程.
# 11 基于图像的三维重建
## PDF补充
### 三维重建的目的,任务
三维重建是计算机视觉的最主要研究方向.
三维重建就是指从单幅图像加景物约束,或二副及二副以上图像恢复空间点三维坐标的过程.

从照相机的成像模型出发:
$$x_i\mathbf{m}_i=\mathbf{K}(\mathbf{R},\mathbf{t})\mathbf{M}_i$$
三维重建的主要目的:从图像出发,求出所有 的$M_{i}$
摄像机标定:从图像出发,求出内参数$K$
摄像机标定位或运动参数求解:从图像出发,求出运动参数$R,t$

三维重建的**三个关键步骤**:
- 图像对应点的确定
- 摄像机标定
- 摄像机运动参数的确定
### 射影几何
照相机的成像是一个射影变换(透视或中心摄影过程).

欧氏几何与射影几何的区别:一部分欧氏几何中保持不变的性质(面积,长度等)在射影几何中不再保持不变.

**无穷远元素**:
平行线交于一个无穷远点;
平行平面交于一个无穷远直线.
一条直线上只有一个无穷远点.
所有无穷远点组成无穷远直线,一个平面只有一条无穷远直线.

**射影空间**:
对n维欧氏空间加入无穷远元素,并对有限和无穷远元素不加以区分,则是n维射影空间.

**齐次坐标**此处不再赘述.

**射影参数**:
对于n维空间中的任意一条直线,如果$P_{1},P_{2}$是它上面的两个任意的点,那么直线的任意一个点都可以由下式生成:
$$X=c_1X_1+c_2X_2$$
其中$X,X_{1},X_{2}$是点的齐次坐标,$c_{1},c_{2}$是两个不全为零的常数.
那么比例$\frac{c_{1}}{c_{2}}$则称为任意一点在直线上的射影参数.

**交比**:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418015650.png]]
定理:设四个不同的共线点中的三点及其交比值为已知，则第四点必唯一确定.

#### 射影变换
记$S_{n},S_{n}'$是两个射影空间,$T$是由前者到后者的映射,若T保持性质:
- 点与直线的结合关系
- 共线四个点的交比
则$T$称为一个n维射影变换.

若点用齐次坐标表示,则射影变换都可以用一个(n+1)\*(n+1)的矩阵表示.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418020447.png]]
T矩阵的行列式非零,那么它是一个**非退化**的射影变换,否则,就是一个退化的射影变换.

照相机的成像过程是一个从三维空间到二维空间的退化的射影变换.

**射影几何**是研究射影空间中在射影变换下保持不变的性质的几何学.
#### 射影平面中的对偶
点和直线的射影平面上的对偶元素.

**对偶原则**:在射影平面离,如果一个命题成立,那么它的对偶命题也成立.(证明见参考资料1)

参考资料:
[【【射影几何】线动也能成点！对偶原理简介（五）】 ](https://www.bilibili.com/video/BV1QHBMY5ESk/?share_source=copy_web&vd_source=34dd435d3d651e8a3a60eacd5873aed9)
#### 调和
如果点对(P1,P2)和(P3，P4)的交比是-1，即：
(P1,P2；P3,P4)=-1
则称(P,P)与(P,P)是**调和**的.

- 线段的中点为无穷远点关于这个线段的两个端点的调和点.
- 因为调和关系是由交比定义的，所以它是射影不变的.
## 分层重建
分层重建就是:通过逐步提升空间假设条件（射影→仿射→欧氏），逐步恢复场景的三维结构.
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022016.png]]
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022023.png]]
### 三种变换(空间)
#### 射影变换
- ​**射影空间**：最宽松的几何约束，仅保持交比、共线/共面性。
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022126.png]]
#### 仿射变换
- ​**仿射空间**：在射影基础上增加平行性、单比（有向线段比例）。
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022145.png]]
#### 刚体变换
- ​**欧氏空间**：最终恢复绝对尺度、角度和距离。
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022208.png]]

![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022325.png]]
### 三种重建
#### 射影重建
射影空间投影矩阵的具体形式:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022457.png]]
射影重建步骤:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022432.png]]
#### 仿射重建
仿射空间投影矩阵的具体形式:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022527.png]]
仿射空间投影矩阵和射影空间投影矩阵之间的关系:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022919.png]]
仿射重建(基于射影重建):
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418022936.png]]
#### 欧式重建
欧几里得空间下射影矩阵的形式:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418023125.png]]
欧氏空间投影矩阵与仿射空间投影矩阵的关系:
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418023144.png]]
#### 重建总结
![[数字图像处理与机器视觉-副本/assets/Pasted image 20250418023203.png]]
#### 分层重建
射影重建
    •基于二幅图象的方法
    •基于因式分解的方法（Factorization)
仿射重建
    •基于模约束的方法( Modular Constraint )
    •基于摄像机平移运动的方法
欧氏重建－－－> 线性方法
## 基于结构光的重建
通过主动投射已知模式（如光栅、编码光）简化匹配过程.
**硬件**：摄像机、投影仪、旋转平台、计算机
过程:
1、摄像机标定
2、光栅平面标定
3、旋转平台标定
4、三维重建
5、三维配准
6、三维融合及三角化
7、纹理映射与三维显示
## 基于控制点极端摄影矩阵:退化图
這是什麽東西.

