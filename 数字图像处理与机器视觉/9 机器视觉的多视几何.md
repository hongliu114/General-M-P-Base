## PDF补充:机器视觉的目标,任务及马尔视觉理论
### 机器视觉的概述
**定义**:计算机视觉是研究用计算机来模拟人和生物的视觉系统功能的技术学科.

**目标**:让计算机能够感知周围视觉世界,了解它的空间组成和变化规律.
过程:传感,抽象,判断,识别,理解
### 马尔视觉理论
#### 马尔视觉系统研究的三个层次
- 计算理论层次(为什么做)
  定义机器视觉的计算目的与计算策略;明确视觉系统的输入输出需求
- 表达与算法层次(怎么做)
  关注如何实现计算理论层定义的目标;这一层次的任务是设计数据结构和算法，以实现计算理论规定的目标.
- 硬件实现层次(用什么做)
  关注如何将算法部署到实际的硬件设备上;这一层次的任务是将表达与算法层的算法转化为可执行的代码，并在物理设备上运行.
#### 马尔视觉系统信息处理的三个阶段
- 图像低层处理
  低层处理阶段的主要目标是处理和分析原始图像数据，提取基本的视觉特征.
	- 图像获取
	- 图像预处理(包括滤波,增强,矫正)
- 中层处理;空间表达与建模
  中层处理阶段的目标是从低层特征中恢复场景的几何结构，构建场景的三维表示
  抽取图像特征,恢复其2.5维结构(深度等信息),进行建模与表达
- 高层分析
  识别和理解场景的语义信息，实现智能分析和决策;这一阶段关注图像的高级语义内容
  识别,分析,理解,描述
#### 马尔视觉理论特点
没有考虑视觉中的选择性与整体性;
不确定和多义性;
计算量大.
## 单视几何
### 透视投影模型
和[[数字图像处理与机器视觉/2 相机成像原理#透视投影模型]]讲的一样,这里也是使用基于齐次坐标的中心投影模型.不过这里使用的矩阵复杂一点.
![[数字图像处理与机器视觉/assets/Pasted image 20250417112741.png]]
公式:
设三维点 $X=(X,Y,Z)^T$ 投影到图像平面坐标 $m=(u,v)^T$,则有
$$s\begin{bmatrix}u\\v\\1\end{bmatrix}=K\begin{bmatrix}R&\mathbf{t}\end{bmatrix}\begin{bmatrix}X\\Y\\Z\\1\end{bmatrix}$$
其中
$s$为比例因子,
$K$为相机内参矩阵,描述了相机内部的物理特性,包括焦距和主点位置,如下:$$K=\begin{bmatrix}f_x&s&u_0\\0&f_y&v_0\\0&0&1\end{bmatrix}$$
$\begin{bmatrix}R&\mathbf{t}\end{bmatrix}$为外参矩阵.外参矩阵由旋转矩阵 R 和平移向量 t 组成，表示相机在世界坐标系中的位置和姿态.其中 $R$ 是一个 3×3 的正交矩阵，$t$ 是一个 3×1 的平移向量.

在实际做题中,内参矩阵外参矩阵并不需要具体单独求解,而是通过计算下面介绍的单应性矩阵来求解成像关系.
### 单视的平面测量(使用单应性矩阵H)
单应性矩阵 $H$(Homography) 是一个 3×3 的非奇异矩阵，用于描述一个平面在两个不同视角下的投影关系.
![[数字图像处理与机器视觉/assets/Pasted image 20250417153649.png]]
上图中Π和其上的三维点X是被拍摄的物体,左下和右下两个点是摄像机的投影中心.
对于单视的平面测量这个要求,我们要做的是像上图一样,从右下角那个点拍摄照片,使用H将拍摄到的X(也就是m')转换到m(因为可见左下投影过去的是基本垂直于Π的),然后因为垂直,直接通过平面几何就可以得出Π上面各种距离的测量.因此重点就是知道两个摄像头,或者说m和m'两个像点之间的转换关系.

根据投影模型的公式,对于两个摄像机可以知道:
$$s_1\begin{bmatrix}u\\v\\1\end{bmatrix}=K_1\begin{bmatrix}R_1&\mathbf{t}_1\end{bmatrix}\begin{bmatrix}X\\Y\\Z\\1\end{bmatrix}$$
$$s_2\begin{bmatrix}u^{\prime}\\v^{\prime}\\1\end{bmatrix}=K_2\begin{bmatrix}R_2&\mathbf{t}_2\end{bmatrix}\begin{bmatrix}X\\Y\\Z\\1\end{bmatrix}$$
通过共同的三维点,就可以讲上面两个公式的左边联系起来,通过略去比例因子,乘各种内参外参矩阵,可以得到**两个像点的关系**(具体怎么求的我不知道,应该也不会要求那么细致):
$$\begin{bmatrix}u^{\prime}\\v^{\prime}\\1\end{bmatrix}=H\begin{bmatrix}u\\v\\1\end{bmatrix}$$
其中H就是单应性矩阵:
$$H=K_2\left(\begin{bmatrix}R_2&\mathbf{t}_2\end{bmatrix}\begin{bmatrix}I-\frac{1}{d}\mathbf{n}\mathbf{n}^T\end{bmatrix}\begin{bmatrix}R_1^T&-R_1^T\mathbf{t}_1\end{bmatrix}\right)K_1^{-1}$$
上面是更普适的情况,如果说假设两个摄像机内参K一致(或者理解成就是同一个相机拍摄两张照片),然后外参矩阵用一个相对位姿矩阵代替(直接代表两个相机之间的位姿关系),那么有H的简化版本:
$$H=K\left(\begin{bmatrix}R&\mathbf{t}\end{bmatrix}\begin{bmatrix}I-\frac{1}{d}\mathbf{n}\mathbf{n}^T\end{bmatrix}\right)K^{-1}$$
这是从原理出发得到H的方法.实际要做单目测量,我们不是直接求得外参内参矩阵,而是从拍摄照片中选取世界坐标系(这个坐标系的z=0平面在被测物体同一平面),标出四个点得到已知数据来求解H,此处略.

总之知道H之后要做的就是利用上面那个两个像点之间关系的式子,或者将其写成:
$$s\mathbf{m}^{\prime}=H\mathbf{m}$$
其中$s$是比例因子.
## 两视几何
两视几何是研究如何通过两个不同视角的图像恢复场景的三维结构.其核心是**对极几何（Epipolar Geometry）​**，描述两个相机之间的几何关系，以及图像点之间的对应约束.

核心目标：
- 利用两幅图像中的匹配点，恢复相机的相对位姿（旋转 R 和平移 t）。
- 通过三角测量（Triangulation）恢复三维点坐标。
### 对极几何
对极几何是研究两幅图像之间存在的几何。它和场景结构无关，只依赖于摄像机的内外参数.
#### 基本概念
![[数字图像处理与机器视觉/assets/Pasted image 20250417162412.png]]
- 基线:连接两个摄像机光心(O和O')之间的直线
- 对极点:基线与像平面的交点
- 对极平面:过基线的平面
- 对极线:对极平面与图像平面的交线
- 基本矩阵$F$:对应点对之间的约束$m'^{T}Fm=0$
#### 公式推导
同样由投影模型的公式,对于两个摄像机拍摄同一个点M,有
$$
\begin{align}
x_{i}m_{i}=K[R_{0},t_{0}]M_{i} \\
x_{i}'m_{i}'=K'[R',t']M_{i}
\end{align}
$$
为了方便,取世界坐标系在第一个摄像机坐标系上,则
$$
\begin{align}
x_{i}m_{i}=K[I,0]M_{i}=PM_{i} \\
x_{i}'m_{i}'=K'[R,t]M_{i}=P'M_{i}
\end{align}
$$

和单视几何部分一样的思路,通过一样的$M_{i}$,可以得到两个m之间的关系:
$$m^{\prime T}(K'^{-T}[t]_\times RK^{-1})m=0$$
$$\text{其中 }[t]_\times\text{ 是平移向量 }t\text{ 的反对称矩阵:}[t]_\times=\begin{bmatrix}0&-t_z&t_y\\t_z&0&-t_x\\-t_y&t_x&0\end{bmatrix}$$
这里中间括号内的部分写成一整个矩阵,就是**基本矩阵**,表达了表达了两个像点m之间的关系:
$$\mathbf{F}=\mathbf{K}^{\prime-T}[\mathbf{t}]_\times\mathbf{R}\mathbf{K}^{-1}$$
基本矩阵是一个秩为2的3\*3矩阵,自由度为7.

与此同时,得到其他概念的数学公式:
**光心**:
$$
\begin{align}
O=[0\,0\,0\,1]^{T} \\
O'=[-R^{T}t,1]^{T}
\end{align}
$$
**对极点**:
$$
\begin{align}
e=PO'=KR^{T}t \\
e'=P'O=K't
\end{align}
$$
**对极线**:
$$
\begin{align}
l=e\times m \\
l'=e'\times m'
\end{align}
$$
**本质矩阵**:
由于基本矩阵包含相机内参,不太方便,所以取中间那部分作为本质矩阵:
$$\mathbf{E}=[\mathbf{t}]_\times\mathbf{R}$$
本质矩阵是一个秩为2 的3\*3矩阵,自由度为5.

不同元素之间的关系式:
$$\mathbf{l}=\mathbf{F}^T\mathbf{m}^{\prime}\quad\mathbf{l}^{\prime}=\mathbf{F}\mathbf{m}\quad\mathbf{F}\mathbf{e}=0\quad\mathbf{e}^T\mathbf{F}=0$$

F的具体算法略,因为看不懂.
### 重建
看不太懂.
![[数字图像处理与机器视觉/assets/Pasted image 20250417175206.png]]
### 景物平面与单应矩阵
单应矩阵的定义这里不再赘述.

**景物平面**是指三维空间中的一个平面，通常假设为 Z=0 的平面.

$$\begin{aligned}\text{若两视点投影矩阵为}\\\mathbf{P}&=\mathbf{K}\begin{bmatrix}\mathbf{I}&\mathbf{0}\end{bmatrix}\quad\mathbf{P}^{\prime}=\mathbf{K}^{\prime}\begin{bmatrix}\mathbf{R}&\mathbf{t}\end{bmatrix}\end{aligned}$$
$$\text{则空间平面}\quad\pi=\begin{pmatrix}\mathbf{n}^T&d\end{pmatrix}^T\quad\text{的单应矩阵H可表示为}$$
$$\mathbf{H}=\mathbf{K}^{\prime}(\mathbf{R}-\mathbf{tn}^T/\mathbf{d})\mathbf{K}^{-1}$$
#### 由F确定H
已知三个空间中的点$M_{1}M_{2}M_{3}$,它们都有各自投影到两个摄像机上的点,那么这三个景物点确定了一个空间平面.
$$\mathbf{Fe}=0\quad\mathbf{e^{\prime}}^\tau\mathbf{F}=0\longrightarrow\mathbf{e},\mathbf{e^{\prime}}$$
$$\begin{aligned}s_i\mathbf{m}_i^{^{\prime}}&=\mathbf{Hm}_i\quad s\mathbf{e}^{^{\prime}}=\mathbf{He}\longrightarrow\mathbf{H}\\i&=1,2,3\end{aligned}$$
#### 由H确定F
![[数字图像处理与机器视觉/assets/Pasted image 20250417181807.png]]
## 三视几何
在两视几何中使用基本矩阵$F$描述两个摄像机之间的约束;
在三视几何中则使用三焦张量$T$描述(Trifocal Tensor)三个摄像机之间的约束;
在四个摄像机或更多视角的情况下不存在独立的约束,可以利用$F$和$T$来生成.
![[数字图像处理与机器视觉/assets/Pasted image 20250417183538.png]]
### 三焦张量
三焦张量由 三个3x3矩阵${T_{1},T_{2},T_{3}}$组成.
对于一个空间直线,三个视角中对应的投影分别记为$l,l',l''$,则有约束公式:
$$\mathbf{l}^T=\mathbf{l}^T[\mathbf{T}_1,\mathbf{T}_2,\mathbf{T}_3]\mathbf{l}^"$$
### 基本矩阵
基本矩阵与三焦张量的关系:
$$\mathbf{F}_{21}=[\mathbf{e}^{^{\prime}}]_\times[\mathbf{T}_1,\mathbf{T}_2,\mathbf{T}_3]\mathbf{e}^{^{\prime\prime}}$$
$$\mathbf{F}_{31}=[e^{\prime\prime}]_x[\mathbf{T}_1^T,\mathbf{T}_2^T,\mathbf{T}_3^T]e^{\prime}$$
### 投影矩阵
$$\mathbf{P}=\begin{bmatrix}\mathbf{I}&\mathbf{0}\end{bmatrix}$$
$$\mathbf{P}^{\prime}=\begin{bmatrix}[\mathbf{T}_1,\mathbf{T}_2,\mathbf{T}_3]\mathbf{e}^{\prime\prime}&\mathbf{e}^{\prime}\end{bmatrix}$$
$$\mathbf{P}^{\prime\prime}=\begin{bmatrix}(\mathbf{e}^{\prime\prime}\mathbf{e}^{\prime\prime T}-\mathbf{I})[\mathbf{T}_1^T,\mathbf{T}_2^T,\mathbf{T}_3^T]\mathbf{e}^{\prime}&\mathbf{e}^{\prime\prime}\end{bmatrix}$$

